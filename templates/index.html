<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê°ì • ë¶„ì„ í…ŒìŠ¤íŠ¸</title>
  <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(to right, #f7cfdc 0%, #cbdff5 100%);
    }

    h2 {
      text-align: center;
      font-size: 26px;
      font-weight: bold;
      margin-top: 50px;
    }

    #inputSection {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }

    textarea {
      width: 60%;
      font-size: 18px;
      padding: 15px;
      border-radius: 20px;
      border: 2px solid #ccc;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      resize: none;
      outline: none;
    }

    button {
      margin-top: 20px;
      padding: 12px 25px;
      font-size: 16px;
      background-color: #f48fb1;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: 0.3s ease;
    }

    button:hover {
      background-color: #ec407a;
    }

    .back-button, .chart-button, .logout-button {
      position: fixed;
      border: none;
      border-radius: 20px;
      padding: 10px 20px;
      font-size: 14px;
      color: white;
      cursor: pointer;
      z-index: 999;
    }

    .back-button {
      top: 20px;
      left: 20px;
      background-color: #ce93d8;
    }

    .chart-button {
      top: 20px;
      right: 20px;
      background-color: #64b5f6;
    }

    .logout-button {
      top: 70px;
      left: 20px;
      background-color: #ff7043;
    }

    .status-button {
      position: fixed;
      top: 70px;         /* chart-button ì•„ë˜ë¡œ ì •ë ¬ */
      right: 20px;       /* ì™¼ìª½ â†’ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìœ„ì¹˜ ì´ë™ */
      background-color: #81c784;
      color: white;
      border: none;
      border-radius: 20px;
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
      z-index: 999;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);  /* ì˜ˆìœ ê·¸ë¦¼ì ìœ ì§€ */
      transition: background-color 0.3s ease;
    }

    .card-container {
      display: flex;
      flex-wrap: nowrap;
      justify-content: center;
      gap: 15px;
      margin: 50px auto 20px;
      max-width: 100%;
      overflow-x: auto;
    }

    .card {
      flex: 1 1 200px;
      max-width: 220px;
      padding: 15px;
      border-radius: 10px;
      background-color: white;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.07);
      text-align: left;
    }

    .media-box {
      margin: 30px auto;
      background-color: white;
      padding: 20px;
      width: 70%;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .media-box img,
    .media-box video,
    .media-box audio {
      max-width: 100%;
      border-radius: 10px;
    }

    .progress-bar {
      background-color: #eee;
      border-radius: 10px;
      overflow: hidden;
      height: 20px;
      margin-top: 5px;
    }

    .progress-fill {
      height: 100%;
      background-color: #81d4fa;
      transition: width 0.3s ease-in-out;
    }

    .quest-button {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background-color: #9575cd;
      color: white;
      border: none;
      border-radius: 20px;
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
      z-index: 999;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
      transition: background-color 0.3s ease;
    }
    .quest-button:hover {
      background-color: #7e57c2;
    }

  </style>
</head>
<body>

  <h2>ğŸ’¬ <strong>ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì€ ì–´ë–¤ê°€ìš”?</strong></h2>

  <button class="logout-button" onclick="location.href='/logout'">ë¡œê·¸ì•„ì›ƒ</button>
  <button id="chartButton" class="chart-button" style="display: none;" onclick="location.href='/history'">ğŸ“Š ê°ì • ë³€í™” ë³´ê¸°</button>
  <button id="backButton" class="back-button" style="display: none;" onclick="resetView()">â† ë‹¤ì‹œ ê°ì • ë¶„ì„í•˜ê¸°</button>
  <button class="status-button" onclick="location.href='/status'">ğŸ“‹ ìƒíƒœ ë³´ê¸°</button>
  <button class="quest-button" onclick="location.href='/quest_history'">ğŸ—‚ï¸ í€˜ìŠ¤íŠ¸ ê¸°ë¡</button>

  <div id="inputSection">
    <textarea id="inputText" rows="4" placeholder="ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë• ë‚˜ìš”? ë§ˆìŒì†ì— ë‚¨ëŠ” ì¼ì´ ìˆì—ˆë‚˜ìš”? [ì˜ˆ: I felt excited when I met my friends.]"></textarea>
    <button onclick="analyzeEmotion()">ë¶„ì„í•˜ê¸°</button>
  </div>

  <div id="result" class="card-container" style="display: none;"></div>
  <div id="mediaArea" class="media-box" style="display: none;"></div>

  <script>
    async function analyzeEmotion() {
      const text = document.getElementById("inputText").value;
      if (!text.trim()) return;

      const response = await fetch('/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text })
      });

      const data = await response.json();
      if (data.error) {
        alert(data.error);
        return;
      }

      // ë·° ì „í™˜
      document.getElementById("inputSection").style.display = "none";
      document.getElementById("backButton").style.display = "block";
      document.getElementById("chartButton").style.display = "block";
      document.getElementById("result").style.display = "flex";
      document.getElementById("mediaArea").style.display = "block";

      const characterImage = `/static/${data.character.replaceAll(" ", "_").toLowerCase()}.png`;
      const expPercent = (data.total_exp % 100);

      document.getElementById("result").innerHTML = `
        <div class="card"><h4>ğŸ§  ê°ì •</h4><p>${data.emotion}</p></div>
        <div class="card"><h4>ğŸ¯ ì •í™•ë„</h4><p>${data.confidence}</p></div>
        <div class="card"><h4>ğŸ’¬ ë°˜ì‘ ë©”ì‹œì§€</h4><p>${data.message}</p></div>
        <div class="card">
          <h4>ğŸ¤ ë“±ì¥ ìºë¦­í„°</h4>
          <img src="${characterImage}" alt="${data.character}" style="width:100%; border-radius:10px;">
          <p style="margin-top:10px; font-weight:bold;">${data.character}</p>
        </div>
        <div class="card">
          <h4>ğŸ“Œ ì¶”ì²œ í€˜ìŠ¤íŠ¸</h4>
          <p style="font-style: italic;">"${data.quest}"</p>
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <a href="${data.link_game}" target="_blank">
              <button style="background-color: #4CAF50;">ğŸ® ê°ì • ë¯¸ì…˜ ë„ì „!</button>
            </a>
            <a href="${data.link_mv}" target="_blank">
              <button style="background-color: #2196F3;">ğŸµ ë®¤ì§ë¹„ë””ì˜¤ ê°ìƒ</button>
            </a>
          </div>
        </div>
        <div class="card">
          <h4>ğŸ§— ê²½í—˜ì¹˜ & ë ˆë²¨</h4>
          <p>ë ˆë²¨: <strong>${data.level}</strong></p>
          <p>í˜„ì¬ ê²½í—˜ì¹˜: ${data.total_exp} / ${(data.level) * 100} EXP</p>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${expPercent}%"></div>
          </div>
        </div>
      `;

      let media = '';
      if (data.content.endsWith(".jpg") || data.content.endsWith(".png")) {
        media = `<img src="/static/${data.content}" alt="ê°ì • ì´ë¯¸ì§€">`;
      } else if (data.content.endsWith(".mp3")) {
        media = `<audio controls autoplay src="/static/${data.content}"></audio>`;
      } else if (data.content.endsWith(".mp4")) {
        media = `<video controls autoplay muted src="/static/${data.content}"></video>`;
      }

      document.getElementById("mediaArea").innerHTML = `
        <h3>ğŸ¬ ê´€ë ¨ ì½˜í…ì¸ </h3>
        ${media}
      `;
    }

    function resetView() {
      document.getElementById("inputText").value = "";
      document.getElementById("inputSection").style.display = "flex";
      document.getElementById("result").style.display = "none";
      document.getElementById("mediaArea").style.display = "none";
      document.getElementById("backButton").style.display = "none";
      document.getElementById("chartButton").style.display = "none";
    }
  </script>

</body>
</html>
